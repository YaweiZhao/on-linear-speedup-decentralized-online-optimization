%\documentclass[twoside]{article}
\documentclass{article}
% If your paper is accepted, change the options for the package
% aistats2019 as follows:
%
%\usepackage[accepted]{aistats2019}
\usepackage{amssymb}
\usepackage{algorithm}
\usepackage{caption}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{tabularx}
\usepackage{pifont}
\usepackage[noend]{algpseudocode}
\usepackage{bm}
\usepackage{array}
\usepackage{balance}
\usepackage{amsthm}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{multirow}
\usepackage{fullpage}
\usepackage{color}

\def\rc{\color{red}}
\def\bc{\color{blue}}

\usepackage[colorlinks,linkcolor=red,citecolor=blue]{hyperref}       % hyperlinks
\usepackage{natbib}
\allowdisplaybreaks
 
\DeclareMathOperator*{\Argmax}{Argmax}
\DeclareMathOperator*{\Argmin}{Argmin}

\input{yaweinewcomm}


 \newtheorem{Definition}{\bf{Definition}}
 \newtheorem{Theorem}{\bf{Theorem}}
 \newtheorem{reTheorem}[Theorem]{\bf{Theorem}}
 \newtheorem{Lemma}{\bf{Lemma}}
 \newtheorem{reLemma}[Lemma]{\bf{Lemma}}
 \newtheorem{Corollary}{\bf{Corollary}}
 \newtheorem{reCorollary}[Corollary]{\bf{Corollary}}
 \newtheorem{Assumption}{\bf{Assumption}}
 \newtheorem{Proposition}{\bf{Proposition}}
 \newtheorem{Remark}{\bf{Remark}}


%\twocolumn[

\title{Decentralized Online Optimization}

\begin{document}

\maketitle

\begin{abstract}
ddd
\end{abstract}

\section{Notations and assumptions}





Define the dynamic regret as
\begin{align}
\nonumber
\Rcal_T^{DOG} = & \EE_{\xi}\sum_{i=1}^n\sum_{t=1}^T f_{i,t}(\x_{i,t};\xi) - f_{i,t}(\x_t^\ast;\xi),
\end{align} where, for any $\x$,
\begin{align}
\nonumber
f_{i,t}(\x;\xi) := \beta \bar{f}_{i,t}(\x) + (1-\beta) f(\x; \xi),
\end{align} and $\xi$ is a random variable drawn from an unknown distribution. $\bar{f}_{i,t}$ is an adversary loss function, and $f$ is a given loss function.



The budget of the dynamics is defined as
\begin{align}
\nonumber
\sum_{t=1}^T \lrnorm{\x_{t+1}^\ast - \x_t^\ast} \le D.
\end{align}



\begin{Assumption}
\label{assumption_bounded_gradient_domain}
For any $i\in[n]$ and $t\in[T]$, we assume $\lrnorm{\nabla f_{i,t}(\x)}^2 \le G$. For any $\x\in\Xcal$ and $\y\in\Xcal$, we assume $\lrnorm{\x-\y}^2 \le R$.
\end{Assumption}

\begin{Assumption}
\label{assumption_differentiable}
For any $i\in[n]$ and $t\in[T]$, we assume the function $f_{i,t}(\x)$ is differentiable with respect to any vector $\x\in\Xcal$.
\end{Assumption}




\section{Algorithm}


\newcommand\StateX{\Statex\hspace{\algorithmicindent}}
\begin{algorithm}[!]
   \caption{DOG: Decentralized Online Gradient.}
   \label{algo_dog}
   \begin{algorithmic}[1]
   \Require The learning rate $\eta$, number of iterations $T$, and the confusion matrix $\W$.
       \For {$t=1,2, ..., T$}
           \StateX For the $i$-th node with $i\in[n]$:
            \State \indent Predict $\x_{i,t}$.
            \State \indent Observe the loss function $f_{i,t}$,
            \StateX \indent and suffer loss $f_{i,t}(\x_{i,t})$.
            \StateX Update:
            \State \indent Query the gradient $\nabla f_{i,t}(\x_{i,t})$.  
            \State \indent $\x_{i,t+1} = \sum_{j=1}^n \W_{i,j}\x_{j,t} - \eta \nabla f_{i,t}(\x_{i,t})$. 
       \EndFor
   \end{algorithmic}
\end{algorithm}










\begin{Theorem}
\label{theorem_regret_upper_bound}
Using Assumptions \ref{assumption_bounded_gradient_domain} and \ref{assumption_differentiable}, and choosing $\eta>0$ in Algorithm \ref{algo_dog}, we have

\begin{align}
\nonumber
\Rcal_T^{DOG} = & \sum_{i=1}^n\sum_{t=1}^T f_{i,t}(\x_{i,t}) - f_t(\x_t^\ast) \\ \nonumber
\le & 13nT\beta G \eta + \lrincir{ (1-\beta)  \lrincir{ L + \frac{\eta L^2}{\beta} + 3\eta L^2 } + \frac{\beta}{\eta} } \frac{nT G \eta^2}{(1-\rho)^2} \\ \nonumber 
&+ n\lrincir{\frac{1}{\beta} + 2}\lrincir{f(\bar{\x}_1) - f(\bar{\x}_{T+1})}   + \frac{n}{2\eta}\lrincir{ 4\sqrt{R}D + R  }.
\end{align}


\end{Theorem}


\begin{Corollary}
Using Assumptions \ref{assumption_bounded_gradient_domain} and \ref{assumption_differentiable}, and choosing $\eta = \frac{1}{\sqrt{\beta TD}}$ in Algorithm \ref{algo_dog}, we have
\begin{align}
\nonumber
\Rcal_T^{DOG} \le \Ocal{n\sqrt{\beta TD}}.
\end{align}




\end{Corollary}








\section*{Appendix}

\textbf{Proof details of Theorem \ref{theorem_regret_upper_bound}:}
\begin{proof}
\begin{align}
\nonumber
& \EE \frac{1}{n}\sum_{i=1}^n f_{i,t}(\x_{i,t}) - f_t(\x_t^\ast) \\ \nonumber
=& \frac{1}{n}\sum_{i=1}^n \beta \lrincir{\bar{f}_{i,t}(\x_{i,t}) - f_t(\x_t^\ast)} + (1-\beta) \EE \lrincir{f(\x_{i,t};\xi) - f(\x_t^\ast)} \\ \nonumber
=& \frac{1}{n}\sum_{i=1}^n \beta \lrincir{\bar{f}_{i,t}(\x_{i,t}) - f_t(\x_t^\ast)} + (1-\beta) \lrincir{f(\x_{i,t}) - f(\x_t^\ast)} \\ \nonumber 
\le & \frac{1}{n}\sum_{i=1}^n \beta \lrangle{\nabla \bar{f}_{i,t}(\x_{i,t}), \x_{i,t} - \x_t^\ast } + (1-\beta) \lrangle{\nabla f(\x_{i,t}), \x_{i,t} - \x_t^\ast } \\ \nonumber
 = & \frac{1}{n}\sum_{i=1}^n \beta \lrincir{\lrangle{\nabla \bar{f}_{i,t}(\x_{i,t}), \x_{i,t} - \bar{\x}_t } + \lrangle{\nabla \bar{f}_{i,t}(\x_{i,t}), \bar{\x}_t - \bar{\x}_{t+1} + \lrangle{\nabla \bar{f}_{i,t}(\x_{i,t}), \bar{\x}_{t+1} - \x_t^\ast } } } \\ \nonumber 
 & + \frac{1}{n}\sum_{i=1}^n (1-\beta) \lrincir{ \lrangle{\nabla f(\x_{i,t}), \x_{i,t} - \bar{\x}_t } +  \lrangle{\nabla f(\x_{i,t}), \bar{\x}_t - \bar{\x}_{t+1} } + \lrangle{\nabla f(\x_{i,t}), \bar{\x}_{t+1} - \x_t^\ast } }\\ \nonumber
= & \underbrace{ \frac{1}{n}\sum_{i=1}^n \beta \lrincir{\lrangle{\nabla \bar{f}_{i,t}(\x_{i,t}), \x_{i,t} - \bar{\x}_t } + \lrangle{\nabla \bar{f}_{i,t}(\x_{i,t}), \bar{\x}_t - \bar{\x}_{t+1} } } }_{I_1(t)} \\ \nonumber 
 & + \underbrace{ \frac{1}{n}\sum_{i=1}^n (1-\beta) \lrincir{ \lrangle{\nabla f(\x_{i,t}), \x_{i,t} - \bar{\x}_t } +  \lrangle{\nabla f(\x_{i,t}), \bar{\x}_t - \bar{\x}_{t+1} }} }_{I_2(t)}\\ \nonumber 
&+ \underbrace{ \frac{1}{n}\sum_{i=1}^n \lrangle{\nabla f_{i,t}(\x_{i,t}), \bar{\x}_{t+1} - \x_t^\ast } }_{I_3(t)}\\ \nonumber
\end{align}

Now, we begin to bound $I_1(t)$.
\begin{align}
\nonumber
I_1(t) \le & \frac{\beta}{n}\sum_{i=1}^n \lrincir{ \frac{\eta}{2}\lrnorm{\nabla \bar{f}_{i,t}(\x_{i,t})}^2 + \frac{1}{2\eta}\lrnorm{\x_{i,t} - \bar{\x}_t}^2  + \frac{\eta}{2}\lrnorm{\nabla f_{i,t}(\x_{i,t})}^2 + \frac{1}{2\eta}\lrnorm{\bar{\x}_t - \bar{\x}_{t+1}}^2 }\\ \nonumber
\le & \beta G \eta + \frac{\beta}{2n\eta }\sum_{i=1}^n \lrnorm{\x_{i,t} - \bar{\x}_t}^2 + \frac{\beta }{2n\eta }\sum_{i=1}^n \lrnorm{\bar{\x}_t - \bar{\x}_{t+1}}^2.
\end{align}

Now, we begin to bound $I_2(t)$.
\begin{align}
\nonumber
I_2(t) = & (1-\beta) \lrincir{\underbrace{ \frac{1}{n}\sum_{i=1}^n\lrangle{\nabla f(\x_{i,t}), \x_{i,t} - \bar{\x}_t } }_{I_{22}(t)} +  \underbrace{ \frac{1}{n}\sum_{i=1}^n\lrangle{\nabla f(\x_{i,t}), \bar{\x}_t - \bar{\x}_{t+1} }}_{I_{23}(t)}}.
\end{align} For $I_{22}(t)$, we have
\begin{align}
\nonumber
I_{22}(t) = & \frac{1}{n}\sum_{i=1}^n\lrangle{\nabla f(\x_{i,t}), \x_{i,t} - \bar{\x}_t } \\ \nonumber
= & \frac{1}{n}\sum_{i=1}^n\lrangle{\nabla f(\x_{i,t}) - \nabla f(\bar{\x}_t), \x_{i,t} - \bar{\x}_t } + \frac{1}{n}\sum_{i=1}^n\lrangle{\nabla f(\bar{\x}_t), \x_{i,t} - \bar{\x}_t } \\ \nonumber
\le & \frac{L}{n}\sum_{i=1}^n \lrnorm{\x_{i,t} - \bar{\x}_t}^2 + \frac{1}{n}\sum_{i=1}^n\lrangle{\nabla f(\bar{\x}_t), \x_{i,t} - \bar{\x}_t } \\ \label{equa_theorem_temp0}
\le & \frac{L}{n}\sum_{i=1}^n \lrnorm{\x_{i,t} - \bar{\x}_t}^2 + \frac{1}{n}\sum_{i=1}^n\lrincir{\frac{\eta}{2\beta}\lrnorm{\nabla f(\bar{\x}_t)}^2 + \frac{\beta}{2\eta}\lrnorm{\x_{i,t} - \bar{\x}_t }^2 }.
\end{align}

According to Lemma \ref{lemma_gradient_norm_bound}, we have
\begin{align}
\nonumber
& \frac{\eta}{2}\lrnorm{\nabla f(\bar{\x}_t)}^2  \\ \nonumber
\le & \frac{\eta}{2}\lrnorm{\nabla f(\bar{\x}_t)}^2 + \lrincir{\frac{\eta}{2} - \frac{L\eta^2}{2}}\lrnorm{\frac{1}{n}\sum_{i=1}^n f_{i,t}(\x_{i,t})}^2 \\ \label{equa_theorem_temp1}
\le & f(\bar{\x}_t) - f(\bar{\x}_{t+1}) + 4G\eta\beta^2 +  \frac{\eta L^2(1-\beta)^2}{n}\sum_{i=1}^n\lrnorm{\bar{\x}_t - \x_{i,t} }^2.
\end{align} Substituting \eqref{equa_theorem_temp1} into \eqref{equa_theorem_temp0}, we obtain
\begin{align}
\nonumber
I_{22}(t) \le & \frac{L}{n}\sum_{i=1}^n \lrnorm{\x_{i,t} - \bar{\x}_t}^2 + \lrincir{ \frac{1}{\beta}\lrincir{f(\bar{\x}_t) - f(\bar{\x}_{t+1})} + 4G\eta\beta +  \frac{\eta L^2(1-\beta)^2}{n\beta}\sum_{i=1}^n\lrnorm{\bar{\x}_t - \x_{i,t} }^2 + \frac{\beta}{2n\eta}\sum_{i=1}^n\lrnorm{\x_{i,t} - \bar{\x}_t }^2 } \\ \nonumber
= & \lrincir{ \frac{L}{n} + \frac{\eta L^2(1-\beta)^2}{n\beta} + \frac{\beta}{2n\eta} }\sum_{i=1}^n\lrnorm{\x_{i,t} - \bar{\x}_t }^2 + \frac{1}{\beta}\lrincir{f(\bar{\x}_t) - f(\bar{\x}_{t+1})} + 4G\eta\beta.
\end{align}

For $I_{23}(t)$, we have
\begin{align}
\nonumber
I_{23}(t) = & \frac{1}{n}\sum_{i=1}^n\lrangle{\nabla f(\x_{i,t}), \bar{\x}_t - \bar{\x}_{t+1} } \\ \nonumber
\le & \frac{1}{n}\sum_{i=1}^n\lrincir{\frac{\eta}{2}\lrnorm{\nabla f(\x_{i,t})}^2 + \frac{1}{2\eta} \lrnorm{ \bar{\x}_t - \bar{\x}_{t+1}}^2 } \\ \nonumber
\le & \frac{1}{n}\sum_{i=1}^n\lrincir{\frac{\eta}{2}\lrnorm{\nabla f(\x_{i,t}) - \nabla f(\bar{\x}_t) + \nabla f(\bar{\x}_t)}^2 + \frac{1}{2\eta} \lrnorm{ \bar{\x}_t - \bar{\x}_{t+1}}^2 } \\ \nonumber
\le & \frac{1}{n}\sum_{i=1}^n\lrincir{ \eta\lrnorm{\nabla f(\x_{i,t}) - \nabla f(\bar{\x}_t)}^2 + \eta \lrnorm{\nabla f(\bar{\x}_t)}^2 + \frac{1}{2\eta} \lrnorm{ \bar{\x}_t - \bar{\x}_{t+1}}^2 } \\ \nonumber
\le & \frac{1}{n}\sum_{i=1}^n\lrincir{ \eta L^2 \lrnorm{\x_{i,t} - \bar{\x}_t}^2 + \eta \lrnorm{\nabla f(\bar{\x}_t)}^2 + \frac{1}{2\eta} \lrnorm{ \bar{\x}_t - \bar{\x}_{t+1}}^2 }.
\end{align} Recall Lemma \ref{lemma_gradient_norm_bound}, and we have
\begin{align}
\nonumber
I_{23}(t) = & \frac{1}{n}\sum_{i=1}^n\lrincir{ \eta L^2 \lrnorm{\x_{i,t} - \bar{\x}_t}^2 + \lrincir{ 2(f(\bar{\x}_t) - f(\bar{\x}_{t+1})) + 8G\eta\beta^2 +  \frac{2\eta L^2(1-\beta)^2}{n}\sum_{i=1}^n\lrnorm{\bar{\x}_t - \x_{i,t} }^2 } }  + \frac{1}{2\eta} \lrnorm{ \bar{\x}_t - \bar{\x}_{t+1}}^2 \\ \nonumber
= & \frac{\eta L^2(1+2(1-\beta)^2)}{n}\sum_{i=1}^n \lrnorm{\x_{i,t} - \bar{\x}_t}^2 + 2(f(\bar{\x}_t) - f(\bar{\x}_{t+1})) + 8G\eta\beta^2 + \frac{1}{2\eta} \lrnorm{ \bar{\x}_t - \bar{\x}_{t+1}}^2 \\ \nonumber
\le & \frac{3\eta L^2}{n}\sum_{i=1}^n \lrnorm{\x_{i,t} - \bar{\x}_t}^2 + 2(f(\bar{\x}_t) - f(\bar{\x}_{t+1})) + 8G\eta\beta^2 + \frac{1}{2\eta} \lrnorm{ \bar{\x}_t - \bar{\x}_{t+1}}^2.
\end{align} Therefore, we obtain
\begin{align}
\nonumber
I_2(t) = & (1-\beta)(I_{22}(t) + I_{23}(t)) \\ \nonumber
\le & (1-\beta) \lrincir{ \lrincir{ \frac{L}{n} + \frac{\eta L^2(1-\beta)^2}{n\beta} + \frac{\beta}{2n\eta} + \frac{3\eta L^2}{n} }\sum_{i=1}^n\lrnorm{\x_{i,t} - \bar{\x}_t }^2 + \lrincir{\frac{1}{\beta} + 2}\lrincir{f(\bar{\x}_t) - f(\bar{\x}_{t+1})} }\\ \nonumber 
&+ (1-\beta) \lrincir{ 4G\eta\beta(1 + 2\beta) +  \frac{1}{2\eta} \lrnorm{ \bar{\x}_t - \bar{\x}_{t+1}}^2 }.
\end{align}





Combine those bounds of $I_1(t)$ and $I_2(t)$. We thus have
\begin{align}
\nonumber
& I_1(t) + I_2(t) \\ \nonumber 
\le & \beta G \eta + \frac{\beta}{2n\eta }\sum_{i=1}^n \lrnorm{\x_{i,t} - \bar{\x}_t}^2 + \frac{\beta }{2n\eta }\sum_{i=1}^n \lrnorm{\bar{\x}_t - \bar{\x}_{t+1}}^2 \\ \nonumber
& + (1-\beta) \lrincir{ \lrincir{ \frac{L}{n} + \frac{\eta L^2(1-\beta)^2}{n\beta} + \frac{\beta}{2n\eta} + \frac{3\eta L^2}{n} }\sum_{i=1}^n\lrnorm{\x_{i,t} - \bar{\x}_t }^2 + \lrincir{\frac{1}{\beta} + 2}\lrincir{f(\bar{\x}_t) - f(\bar{\x}_{t+1})} }\\ \nonumber 
&+ (1-\beta) \lrincir{ 4G\eta\beta(1 + 2\beta) +  \frac{1}{2\eta} \lrnorm{ \bar{\x}_t - \bar{\x}_{t+1}}^2 } \\ \nonumber
= & \lrincir{1 + 4(1-\beta)(1+2\beta)}\beta G \eta + \lrincir{ (1-\beta)  \lrincir{ \frac{L}{n} + \frac{\eta L^2(1-\beta)^2}{n\beta} + \frac{\beta}{2n\eta} + \frac{3\eta L^2}{n} } + \frac{\beta}{2n\eta} }\sum_{i=1}^n\lrnorm{\x_{i,t} - \bar{\x}_t }^2 \\ \nonumber 
&+ \lrincir{\frac{1}{\beta} + 2}\lrincir{f(\bar{\x}_t) - f(\bar{\x}_{t+1})} + \frac{1}{2\eta}\lrnorm{ \bar{\x}_t - \bar{\x}_{t+1}}^2 \\ \nonumber
\le & 13\beta G \eta + \lrincir{ (1-\beta)  \lrincir{ \frac{L}{n} + \frac{\eta L^2}{n\beta} + \frac{3\eta L^2}{n} } + \frac{\beta}{n\eta} }\sum_{i=1}^n\lrnorm{\x_{i,t} - \bar{\x}_t }^2 \\ \nonumber 
&+ \lrincir{\frac{1}{\beta} + 2}\lrincir{f(\bar{\x}_t) - f(\bar{\x}_{t+1})} + \frac{1}{2\eta}\lrnorm{ \bar{\x}_t - \bar{\x}_{t+1}}^2.
\end{align}






According to \ref{lemma_x_variance_norm_square}, we have
\begin{align}
\nonumber
\frac{1}{n}\sum_{i=1}^n \sum_{t=1}^T \lrnorm{\x_{i,t} - \bar{\x}_t}^2 \le \frac{1}{(1-\rho)^2} \sum_{t=1}^T \eta^2 G.
\end{align} Therefore, 
\begin{align}
\nonumber
&\sum_{t=1}^T (I_1(t) + I_2(t)) \\ \nonumber
\le & 13T\beta G \eta + \lrincir{ (1-\beta)  \lrincir{ \frac{L}{n} + \frac{\eta L^2}{n\beta} + \frac{3\eta L^2}{n} } + \frac{\beta}{n\eta} }\sum_{t=1}^T\sum_{i=1}^n\lrnorm{\x_{i,t} - \bar{\x}_t }^2 \\ \nonumber 
&+ \lrincir{\frac{1}{\beta} + 2}\sum_{t=1}^T\lrincir{f(\bar{\x}_t) - f(\bar{\x}_{t+1})} + \frac{1}{2\eta}\sum_{t=1}^T\lrnorm{ \bar{\x}_t - \bar{\x}_{t+1}}^2 \\ \nonumber
\le & 13T\beta G \eta + \lrincir{ (1-\beta)  \lrincir{ \frac{L}{n} + \frac{\eta L^2}{n\beta} + \frac{3\eta L^2}{n} } + \frac{\beta}{n\eta} } \frac{nT G \eta^2}{(1-\rho)^2} \\ \nonumber 
&+ \lrincir{\frac{1}{\beta} + 2}\sum_{t=1}^T\lrincir{f(\bar{\x}_1) - f(\bar{\x}_{T+1})} + \frac{1}{2\eta}\sum_{t=1}^T\lrnorm{ \bar{\x}_t - \bar{\x}_{t+1}}^2.
\end{align}






Now, we begin to bound $I_3(t)$. Recall that the update rule is 
\begin{align}
\nonumber
\x_{i,t+1} = \sum_{j=1}^n \W_{ij}\x_{j,t} - \eta \nabla f_{i,t}(\x_{i,t}).
\end{align} By taking average over $i\in[n]$ on both sides, we have 
\begin{align}
\label{equa_thoerem_update_rule_equivalent}
\bar{\x}_{t+1} = \bar{\x}_t - \eta \lrincir{\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t})}.
\end{align} 
Denote a new auxiliary function $h(\z)$ as 
\begin{align}
\nonumber
h(\z) = \lrangle{\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t}), \z} + \frac{1}{2\eta}\lrnorm{\z - \bar{\x}_t}^2.
\end{align} Note that \eqref{equa_thoerem_update_rule_equivalent} is equivalent to 
\begin{align}
\nonumber
\bar{\x}_{t+1} = & \argmin_{\z\in\RR^d} h(\z) \\ \nonumber
= & \argmin_{\z\in\RR^d} \lrangle{\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t}), \z} + \frac{1}{2\eta}\lrnorm{\z - \bar{\x}_t}^2.
\end{align} Furthermore, denote a new auxiliary variable $\bar{\x}_{\tau}$ as  
\begin{align}
\nonumber
\bar{\x}_{\tau} = \bar{\x}_{t+1} + \tau \lrincir{\x_t^\ast - \bar{\x}_{t+1}},
\end{align} where $0\le \tau \le 1$. According to the optimality of $\bar{\x}_{t+1}$, we have
\begin{align}
\nonumber
0 \le & h(\bar{\x}_{\tau}) - h(\bar{\x}_{t+1}) \\ \nonumber
= & \lrangle{\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t}), \bar{\x}_{\tau} - \bar{\x}_{t+1}} + \frac{1}{2\eta}\lrincir{ \lrnorm{\bar{\x}_{\tau} - \bar{\x}_t}^2 - \lrnorm{\bar{\x}_{t+1} - \bar{\x}_t}^2 } \\ \nonumber
= & \lrangle{\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t}), \tau \lrincir{\x_t^\ast - \bar{\x}_{t+1}}} + \frac{1}{2\eta}\lrincir{ \lrnorm{\bar{\x}_{t+1} + \tau \lrincir{\x_t^\ast - \bar{\x}_{t+1}} - \bar{\x}_t}^2 - \lrnorm{\bar{\x}_{t+1} - \bar{\x}_t}^2 } \\ \nonumber
= & \lrangle{\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t}), \tau \lrincir{\x_t^\ast - \bar{\x}_{t+1}}} + \frac{1}{2\eta}\lrincir{ \lrnorm{\tau \lrincir{\x_t^\ast - \bar{\x}_{t+1}}}^2 + 2\lrangle{\tau \lrincir{\x_t^\ast - \bar{\x}_{t+1}}, \bar{\x}_{t+1} - \bar{\x}_t } }.
\end{align} Dividing $\tau$ on both sides, and letting $\tau$ be close to $0$, we have
\begin{align}
\nonumber
I_3(t) = & \lrangle{\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t}), \bar{\x}_{t+1} - \x_t^\ast} \\ \nonumber 
\le & \frac{1}{2\eta}\lrincir{ \lim_{\tau \rightarrow 0}\tau \lrnorm{\lrincir{\x_t^\ast - \bar{\x}_{t+1}}}^2 + 2\lrangle{ \x_t^\ast - \bar{\x}_{t+1}, \bar{\x}_{t+1} - \bar{\x}_t } } \\ \nonumber
= & \frac{1}{\eta}\lrangle{ \x_t^\ast - \bar{\x}_{t+1}, \bar{\x}_{t+1} - \bar{\x}_t } \\ \label{equa_I3_temp}
= & \frac{1}{2\eta}\lrincir{ \lrnorm{\x_t^\ast - \bar{\x}_t}^2 - \lrnorm{\x_t^\ast - \bar{\x}_{t+1}}^2 - \lrnorm{\bar{\x}_t - \bar{\x}_{t+1}}^2 }. 
\end{align} Besides, we have
\begin{align}
\nonumber
& \lrnorm{\x_{t+1}^\ast - \bar{\x}_{t+1}}^2 - \lrnorm{\x_t^\ast - \bar{\x}_{t+1}}^2 \\ \nonumber 
= & \lrnorm{\x_{t+1}^\ast}^2 - \lrnorm{\x_t^\ast}^2 - 2\lrangle{\bar{\x}_{t+1}, -\x_t^\ast + \x_{t+1}^\ast} \\ \nonumber
= & \lrincir{\lrnorm{\x_{t+1}^\ast} - \lrnorm{\x_t^\ast}} \lrincir{\lrnorm{\x_{t+1}^\ast} + \lrnorm{\x_t^\ast}} - 2\lrangle{\bar{\x}_{t+1}, -\x_t^\ast + \x_{t+1}^\ast} \\ \nonumber
\le & \lrnorm{\x_{t+1}^\ast - \x_t^\ast} \lrincir{\lrnorm{\x_{t+1}^\ast} + \lrnorm{\x_t^\ast}} - 2\lrnorm{\bar{\x}_{t+1}} \lrnorm{\x_{t+1}^\ast-\x_t^\ast} \\ \nonumber
\le & 4\sqrt{R}\lrnorm{\x_{t+1}^\ast - \x_t^\ast}.    ~~~~(\text{due to } \lrnorm{\x - \y}^2 \le R, \forall \x, \y\in\Xcal) 
\end{align} Thus, telescoping $I_3(t)$ over $t\in[T]$, we have 
\begin{align}
\nonumber
\sum_{t=1}^T I_3(t) \le & \frac{1}{2\eta}\lrincir{ 4\sqrt{R}\sum_{t=1}^T\lrnorm{\x_{t+1}^\ast - \x_t^\ast} + \lrnorm{\bar{\x}_1^\ast - \bar{\x}_1}^2 - \lrnorm{\bar{\x}_T^\ast - \bar{\x}_{T+1}}^2 } - \frac{1}{2\eta} \sum_{t=1}^T \lrnorm{\bar{\x}_t - \bar{\x}_{t+1}} \\ \nonumber
\le & \frac{1}{2\eta}\lrincir{ 4\sqrt{R}\sum_{t=1}^T D + R } - \frac{1}{2\eta} \sum_{t=1}^T \lrnorm{\bar{\x}_t - \bar{\x}_{t+1} }.
\end{align} 


Combining those bounds of $I_1(t)$, $I_2(t)$ and $I_3(t)$ together, we finally obtain
\begin{align}
\nonumber
& \EE \sum_{t=1}^T\sum_{i=1}^n f_{i,t}(\x_{i,t}) - f_t(\x_t^\ast) \\ \nonumber
\le & n \sum_{t=1}^T \lrincir{ I_1(t) + I_2(t) + I_3(t) } \\ \nonumber
\le & 13nT\beta G \eta + \lrincir{ (1-\beta)  \lrincir{ L + \frac{\eta L^2}{\beta} + 3\eta L^2 } + \frac{\beta}{\eta} } \frac{nT G \eta^2}{(1-\rho)^2} \\ \nonumber 
&+ n\lrincir{\frac{1}{\beta} + 2}\lrincir{f(\bar{\x}_1) - f(\bar{\x}_{T+1})}   + \frac{n}{2\eta}\lrincir{ 4\sqrt{R}D + R  }.
\end{align} 












\end{proof}





\begin{Lemma}
\label{lemma_gradient_norm_bound}

\nonumber
\begin{align}
\nonumber
\frac{\eta}{2}\lrnorm{\nabla f(\bar{\x}_t)}^2 + \lrincir{\frac{\eta}{2} - \frac{L\eta^2}{2}}\lrnorm{\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t})}^2 \le f(\bar{\x}_t) - f(\bar{\x}_{t+1}) + 4G\eta\beta^2 +  \frac{\eta L^2(1-\beta)^2}{n}\sum_{i=1}^n\lrnorm{\bar{\x}_t - \x_{i,t} }^2.
\end{align}
\end{Lemma}
\begin{proof}

\begin{align}
\nonumber
f(\bar{\x}_{t+1})\le & f(\bar{\x}_t) + \lrangle{\nabla f(\bar{\x}_t), \bar{\x}_{t+1} - \bar{\x}_t} + \frac{L}{2}\lrnorm{\bar{\x}_{t+1} - \bar{\x}_t}^2 \\ \nonumber
= & f(\bar{\x}_t) + \lrangle{\nabla f(\bar{\x}_t), -\frac{\eta}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t})} + \frac{L}{2}\lrnorm{\frac{\eta}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t})}^2 \\ \nonumber
= & f(\bar{\x}_t) + \frac{\eta}{2}\lrincir{\lrnorm{\nabla f(\bar{\x}_t) -\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t})}^2 - \lrnorm{\nabla f(\bar{\x}_t)}^2 - \lrnorm{\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t})}^2 } + \frac{L}{2}\lrnorm{\frac{\eta}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t})}^2 \\ \label{equa_lemma_norm_gradient_square}
= & f(\bar{\x}_t) + \frac{\eta}{2}\lrnorm{\nabla f(\bar{\x}_t) -\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t})}^2 - \frac{\eta}{2}\lrnorm{\nabla f(\bar{\x}_t)}^2 - \lrincir{\frac{\eta}{2} - \frac{L\eta^2}{2}}\lrnorm{\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t})}^2.
\end{align} 

Additionally, we have
\begin{align}
\nonumber
& \lrnorm{\nabla f(\bar{\x}_t) -\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t})}^2 \\ \nonumber
= & \lrnorm{\nabla f(\bar{\x}_t) -\frac{1}{n}\sum_{i=1}^n \lrincir{\beta \nabla \bar{f}_{i,t}(\x_{i,t}) + (1-\beta) \nabla f(\x_{i,t}) }}^2 \\ \nonumber
\le & 2\beta^2\lrnorm{\nabla f(\bar{\x}_t) -\frac{1}{n}\sum_{i=1}^n \nabla \bar{f}_{i,t}(\x_{i,t})  }^2 + 2(1-\beta)^2 \lrnorm{ \nabla f(\bar{\x}_t) - \frac{1}{n}\sum_{i=1}^n \nabla f(\x_{i,t}) }^2\\ \nonumber
\le & 2\beta^2\lrincir{2\lrnorm{\nabla f(\bar{\x}_t)}^2 + 2\lrnorm{\frac{1}{n}\sum_{i=1}^n \nabla \bar{f}_{i,t}(\x_{i,t})  }^2} + 2(1-\beta)^2 \lrnorm{ \nabla f(\bar{\x}_t) - \frac{1}{n}\sum_{i=1}^n \nabla f(\x_{i,t}) }^2\\ \nonumber
\le & 8G\beta^2 + 2(1-\beta)^2 \lrnorm{ \nabla f(\bar{\x}_t) - \frac{1}{n}\sum_{i=1}^n \nabla f(\x_{i,t}) }^2\\ \nonumber
\le & 8G\beta^2 +  \frac{2(1-\beta)^2}{n}\sum_{i=1}^n\lrnorm{ \nabla f(\bar{\x}_t) -  \nabla f(\x_{i,t}) }^2\\ \label{equa_lemma_norm_gradient_square_temp1}
\le & 8G\beta^2 +  \frac{2L^2(1-\beta)^2}{n}\sum_{i=1}^n\lrnorm{\bar{\x}_t - \x_{i,t} }^2.
\end{align}
Substituting \eqref{equa_lemma_norm_gradient_square_temp1} into \eqref{equa_lemma_norm_gradient_square}, we obtain
\begin{align}
\nonumber
f(\bar{\x}_{t+1})\le f(\bar{\x}_t) + \frac{\eta}{2}\lrincir{8G\beta^2 +  \frac{2L^2(1-\beta)^2}{n}\sum_{i=1}^n\lrnorm{\bar{\x}_t - \x_{i,t} }^2} - \frac{\eta}{2}\lrnorm{\nabla f(\bar{\x}_t)}^2 - \lrincir{\frac{\eta}{2} - \frac{L\eta^2}{2}}\lrnorm{\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t})}^2.
\end{align} Equivalently, we obtain
\begin{align}
\nonumber
\frac{\eta}{2}\lrnorm{\nabla f(\bar{\x}_t)}^2 + \lrincir{\frac{\eta}{2} - \frac{L\eta^2}{2}}\lrnorm{\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t})}^2 \le f(\bar{\x}_t) - f(\bar{\x}_{t+1}) + 4G\eta\beta^2 +  \frac{\eta L^2(1-\beta)^2}{n}\sum_{i=1}^n\lrnorm{\bar{\x}_t - \x_{i,t} }^2.
\end{align} It completes the proof.



\end{proof}


\begin{Lemma}
\label{lemma_x_variance_norm_square}

\begin{align}
\nonumber
\frac{1}{n}\sum_{i=1}^n \sum_{t=1}^T \lrnorm{\x_{i,t} - \bar{\x}_t}^2 \le \frac{1}{(1-\rho)^2} \sum_{t=1}^T \eta^2 G.
\end{align}

\end{Lemma}
\begin{proof}


Recall that 
\begin{align}
\nonumber
\x_{i,t+1} = \sum_{j=1}^n \W_{ij}\x_{j,t} - \eta \nabla f_{i,t}(\x_{i,t}),
\end{align} and 
\begin{align}
\nonumber
\bar{\x}_{t+1} = \bar{\x}_t - \eta \lrincir{\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t})}.
\end{align} Denote 
\begin{align}
\nonumber
\X_t = &  [\x_{1,t}, \x_{2,t}, ..., \x_{n,t}] \in \RR^{d\times n}, \\ \nonumber
\G_t = & [\nabla f_{1,t}(\x_{1,t}), \nabla f_{2,t}(\x_{2,t}), ..., \nabla f_{n,t}(\x_{n,t})] \in \RR^{d\times n}.
\end{align} By letting $\x_{i,1} = \0$ for any $i\in[n]$, the update rule is re-formulated as 
\begin{align}
\nonumber
\X_{t+1} = \X_t \W - \eta \G_t = - \sum_{s=1}^t \eta \G_s \W^{t-s}. 
\end{align} Similarly, denote $\bar{\G}_t = \frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t})$, and we have
\begin{align}
\bar{\x}_{t+1} = \bar{\x}_t - \eta \lrincir{\frac{1}{n}\sum_{i=1}^n \nabla f_{i,t}(\x_{i,t})} = - \sum_{s=1}^t \eta \bar{\G}_s. 
\end{align}


Therefore, 
\begin{align}
\nonumber
& \sum_{i=1}^n \lrnorm{\x_{i,t} - \bar{\x}_t}^2 \\ \nonumber
\refabovecir{=}{\textcircled{1}} & \sum_{i=1}^n \lrnorm{ \sum_{s=1}^{t-1} \eta \bar{\G}_s - \eta \G_s \W^{t-s-1}\e_i }^2   \\ \nonumber
\refabovecir{=}{\textcircled{2}} & \lrnorm{ \sum_{s=1}^{t-1} \eta \G_s\v_1 \v_1\Tr - \eta \G_s \W^{t-s-1} }^2_F   \\ \nonumber
\refabovecir{\le}{\textcircled{3}} & \lrincir{ \eta \rho^{t-s-1} \lrnorm{\sum_{s=1}^{t-1}\G_s}_F}^2 \\ \nonumber
\le & \lrincir{ \sum_{s=1}^{t-1} \eta \rho^{t-s-1} \lrnorm{\G_t}_F}^2.
\end{align} $\textcircled{1}$ holds due to $\e_i$ is a unit basis vector, whose $i$-th element is $1$ and other elements are $0$s. $\textcircled{2}$ holds due to $\v_1 = \frac{\1_n}{\sqrt{n}}$. $\textcircled{3}$ holds due to Lemma \ref{lemma_hanlin_1}. 

According to Lemma \ref{lemma_hanlin_2}, letting $a_{t-1} = \sum_{s=1}^{t-1} \rho^{t-s-1} \lrnorm{\G_t}_F$ and $b_{t-1} = \lrnorm{\G_t}_F$, we have
\begin{align}
\nonumber
\frac{1}{n}\sum_{i=1}^n \sum_{t=1}^T \lrnorm{\x_{i,t} - \bar{\x}_t}^2 \le & \frac{1}{n(1-\rho)^2} \sum_{t=1}^T \eta^2 \lrnorm{\G_t}_F^2 \\ \nonumber
\le & \frac{1}{(1-\rho)^2} \sum_{t=1}^T \eta^2 G.
\end{align}
It completes the proof.


\end{proof}








\begin{Lemma}[Appeared in Lemma $5$ in \citep{Tang:2018un}]
\label{lemma_hanlin_1}
For any matrix $\X_t\in\RR^{d\times n}$, decompose the confusion matrix $\W$ as $\W = \sum_{i=1}^n \lambda_i \v_i \v_i\Tr = \P \bLambda \P\Tr$, where $\P = [\v_1, \v_2, ..., \v_n]\in\RR^{n\times n}$, $\v_i$ is the normalized eigenvector of $\lambda_i$. $\bLambda$ is a diagonal matrix, and $\lambda_i$ be its $i$-th element. We have
\begin{align}
\nonumber
\lrnorm{\X_t \W^t - \X_t \v_1 \v_1\Tr }_F^2 \le \lrnorm{\rho^t \X_t}_F^2, 
\end{align} where  $\rho = \max \{| \lambda_2(\W) |, | \lambda_n(\W) |\}$. 

\end{Lemma}


\begin{Lemma}[Appeared in Lemma $6$ in \citep{Tang:2018un}]
\label{lemma_hanlin_2}
Given two non-negative sequences $\{a_t\}_{t=1}^{\infty}$ and $\{b_t\}_{t=1}^{\infty}$ that satisfying
\begin{align}
\nonumber
a_t = \sum_{s=1}^t \rho^{t-s} b_s,
\end{align} with $\rho \in [0,1)$, we have
\begin{align}
\nonumber
\sum_{t=1}^k a_t^2 \le \frac{1}{(1-\rho)^2}\sum_{t=1}^k b_s^2.
\end{align}
\end{Lemma}















%\section*{References}
\bibliography{reference}

\bibliographystyle{abbrvnat}




\end{document}